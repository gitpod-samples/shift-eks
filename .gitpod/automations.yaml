services:
  eks-anywhere:
    name: EKS Anywhere
    description: AWS EKS Anywhere cluster running on Docker provider
    triggeredBy:
      - postEnvironmentStart
    commands:
      start: bash .devcontainer/start-eks-anywhere.sh
      ready: |
        docker ps --format '{{.Names}}' | grep -q "^eks-local-eks-a-cluster-control-plane$" || exit 1
        export KUBECONFIG=/workspaces/shift-eks/.eks-clusters/eks-local/generated/eks-local.kind.kubeconfig
        [ -f "$KUBECONFIG" ] || exit 1
        kubectl --context eks-anywhere get nodes 2>/dev/null | grep -q "Ready"
      stop: bash .devcontainer/stop-eks-anywhere.sh

  eks-localstack:
    name: EKS LocalStack
    description: AWS EKS cluster via LocalStack Pro (requires LOCALSTACK_AUTH_TOKEN)
    triggeredBy:
      - manual
    commands:
      start: bash .devcontainer/start-eks-localstack.sh
      ready: |
        export KUBECONFIG=/workspaces/shift-eks/.eks-clusters/eks-localstack/kubeconfig
        kubectl --context eks-localstack get nodes 2>/dev/null | grep -q "Ready"
      stop: bash .devcontainer/stop-eks-localstack.sh

  openshift-okd:
    name: OpenShift OKD
    description: OpenShift-compatible cluster running on kind with OLM and OpenShift CRDs
    triggeredBy:
      - postEnvironmentStart
    commands:
      start: bash .devcontainer/start-openshift-okd.sh
      ready: kubectl --context okd get nodes 2>/dev/null | grep -q "Ready"
      stop: bash .devcontainer/stop-openshift-okd.sh
